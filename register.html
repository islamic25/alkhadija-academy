<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Register</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
</head>
<body>
  <h2>Register</h2>
  <form onsubmit="registerUser(event)">
    <input type="text" id="name" placeholder="Name" required><br>
    <input type="email" id="email" placeholder="Email" required><br>
    <input type="password" id="password" placeholder="Password" required><br>
    <button type="submit">Register</button>
  </form>
  <p id="message"></p>

  <script>
    window.onload = function () {
      const firebaseConfig = {
        apiKey: "AIzaSyCAAbxJ_tnUQCVLtJrBxPYKq7cYFnabhNk",
        authDomain: "alkhadija-e0cbb.firebaseapp.com",
        projectId: "alkhadija-e0cbb",
        storageBucket: "alkhadija-e0cbb.appspot.com",
        messagingSenderId: "129990677542",
        appId: "1:129990677542:web:bf397865475d7c777d02e7"
      };

      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      console.log("✅ Firebase connected");

      window.registerUser = function (event) {
        event.preventDefault();
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const message = document.getElementById("message");

        auth.createUserWithEmailAndPassword(email, password)
          .then(userCred => {
            return userCred.user.sendEmailVerification().then(() => {
              return db.collection("users").doc(userCred.user.uid).set({
                name, email, createdAt: new Date()
              });
            });
          })
          .then(() => {
            message.style.color = "green";
            message.textContent = "Registered! Check your email to verify.";
          })
          .catch(err => {
            message.style.color = "red";
            message.textContent = err.message;
            console.error("❌ Error:", err);
          });
      };
    };
  </script>
</body>
</html>
